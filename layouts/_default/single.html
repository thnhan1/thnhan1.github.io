{{ define "title" }}
{{ .Title }} - {{ .Site.Title }}
{{ end }}

{{ define "main" }}
<h1 class="title-h1">{{ .Title }}</h1>

{{ $displayHead := .Params.display_head | default true }}

{{ if not $displayHead }}
  <div class="article-header">
    {{ with .Params.preface }}
    <span class="preface">{{ . }}</span>
    {{ end }}
    {{ with .Params.preface_author }}
    <span class="preface-author">{{ . }}</span>
    {{ end }}
    <span class="article-author">{{ or .Params.article_author .Site.Params.author }}</span>
    {{ $dateMachine := .Date | time.Format "2006-01-02T15:04:05-07:00" }}
    {{ $dateHuman := .Date | time.Format ":date_long" }}
    <time datetime="{{ $dateMachine }}">{{ $dateHuman }}</time>
  </div>

  {{ end }}

  <!-- tags -->
<ul class="tags">
  {{ range .Params.tags }}
    <li>
      <a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}/" class="tag-link">#{{ . }}</a>
    </li>
  {{ end }}
</ul>
<style>
  .tags {
    list-style: none;
    padding: 0;
    margin: 1rem 0;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  .tags li {
    display: inline;
  }
  .tag-link {
    background: #f3f3f3;
    color: #333;
    padding: 0.3em 0.7em;
    border-radius: 1em;
    text-decoration: none;
    font-size: 0.95em;
    transition: background 0.2s;
  }
  .tag-link:hover {
    background: #e0e0e0;
  }
</style>

  {{ .Content }}

{{ with .Params.novel }}
<style>
  h1, h2, h3, h4, h5, h6 {
    text-align: center;
    margin: 1rem 0;
  }
  .special {
    margin: 1rem 0;
  }
</style>
{{ end }}

{{ with .Params.license }}
<div class="article-license">
  {{ $dynamicContent := safeHTML (printf (index $.Site.Data.l10n $.Site.Language.Lang "license") $.Params.license_url) }}
  {{ $renderedContent := replace $dynamicContent "__license__" . }}
  <span>{{ $renderedContent | safeHTML }}</span>
</div>
{{ end }}

<div class="backtotop" id="backtotop">
  <a href="#top"><img src="/assets/imgs/backtotop.webp" alt="Back to top"></a>
</div>

{{ partial "comments.html" .}}

{{ end }}
